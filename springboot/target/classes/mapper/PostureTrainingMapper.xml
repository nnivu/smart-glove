<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.PostureTrainingMapper">

    <!-- 结果映射：实体与数据库表字段映射 -->
    <resultMap id="PostureTrainingResultMap" type="com.example.entity.PostureTraining">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="dataset_name" property="datasetName" jdbcType="VARCHAR"/>
        <result column="score" property="score" jdbcType="DOUBLE"/>
        <result column="risk_level" property="riskLevel" jdbcType="VARCHAR"/>
        <result column="progress" property="progress" jdbcType="DOUBLE"/>
        <result column="device_status" property="deviceStatus" jdbcType="VARCHAR"/>
        <result column="arm_angle" property="armAngle" jdbcType="DOUBLE"/>
        <result column="wrist_position" property="wristPosition" jdbcType="DOUBLE"/>
        <result column="body_posture" property="bodyPosture" jdbcType="VARCHAR"/>
        <result column="spray_distance" property="sprayDistance" jdbcType="DOUBLE"/>
        <result column="spray_angle" property="sprayAngle" jdbcType="DOUBLE"/>
        <result column="pressure" property="pressure" jdbcType="DOUBLE"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 查询最新的训练数据（按创建时间倒序取第一条） -->
    <select id="selectLatestTraining" resultMap="PostureTrainingResultMap">
        SELECT
            id, dataset_name, score, risk_level, progress, device_status,
            arm_angle, wrist_position, body_posture, spray_distance,
            spray_angle, pressure, create_time, update_time
        FROM t_posture_training
        ORDER BY create_time DESC
            LIMIT 1
    </select>

    <!-- 根据时间范围查询训练数据 -->
    <select id="selectByTimeRange" resultMap="PostureTrainingResultMap">
        SELECT
            id, dataset_name, score, risk_level, progress, device_status,
            arm_angle, wrist_position, body_posture, spray_distance,
            spray_angle, pressure, create_time, update_time
        FROM t_posture_training
        WHERE create_time BETWEEN #{startTime} AND #{endTime}
        ORDER BY create_time DESC
    </select>

    <!-- 插入训练数据 -->
    <insert id="insert" parameterType="com.example.entity.PostureTraining" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_posture_training (
            dataset_name, score, risk_level, progress, device_status,
            arm_angle, wrist_position, body_posture, spray_distance,
            spray_angle, pressure, create_time, update_time
        ) VALUES (
                     #{datasetName}, #{score}, #{riskLevel}, #{progress}, #{deviceStatus},
                     #{armAngle}, #{wristPosition}, #{bodyPosture}, #{sprayDistance},
                     #{sprayAngle}, #{pressure}, #{createTime}, #{updateTime}
                 )
    </insert>

</mapper>