<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.KeyPointMapper">

    <!-- 结果映射：KeyPoint实体与数据库表字段的映射 -->
    <resultMap id="KeyPointResultMap" type="com.example.entity.KeyPoint">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="x" property="x" jdbcType="INTEGER"/>
        <result column="y" property="y" jdbcType="INTEGER"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="training_id" property="trainingId" jdbcType="BIGINT"/>
    </resultMap>

    <!-- 根据训练ID查询关键点数据 -->
    <select id="selectByTrainingId" resultMap="KeyPointResultMap">
        SELECT id, name, x, y, status, training_id
        FROM t_key_point
        WHERE training_id = #{trainingId}
    </select>

    <!-- 查询最新训练的关键点数据（按创建时间倒序取第一条训练的所有关键点） -->
    <select id="selectLatestKeyPoints" resultMap="KeyPointResultMap">
        SELECT kp.id, kp.name, kp.x, kp.y, kp.status, kp.training_id
        FROM t_key_point kp
                 INNER JOIN (
            SELECT training_id
            FROM t_posture_training
            ORDER BY create_time DESC
                LIMIT 1
        ) t ON kp.training_id = t.training_id
    </select>

</mapper>